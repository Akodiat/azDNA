<html>
	<head>
		<title>oxview wrapper</title>
	</head>
	<style>
		body {
			margin:0;
			padding:0;
		}
		iframe {
			width:80%;
			height:80%;
		}
	</style>

	<body>

		<iframe name="editor-frame" src="http://localhost:8000/"></iframe>
		<input type="file" onchange="openFiles(this.files)" multiple>

	</body>

	<script>
		var frame = window.frames['editor-frame'];

		var openFiles = function(files) {
			//console.log(files);
			//frame.document.dispatchEvent(new Event('drop'));
			//console.log("EVENT DISPATCHED!")
			console.log(files);
			dispatchFakeDrop(files);
		}

		var dispatchFakeDrop = function(files) {
			console.log("called");
			var fakeDropEvent = new DragEvent('drop');
		// You override dataTransfer with whichever property
		// and method the drop function needs
		
		Object.defineProperty(fakeDropEvent, 'dataTransfer', {
			value: new FakeDataTransfer(files)
		});
		frame.renderer.domElement.dispatchEvent(fakeDropEvent);
		console.log("dispatched");
		}


		var finishedLoading = function() {
			console.log("child finished loading!");
			//dispatchFakeDrop();
		}

		function FakeDataTransfer(files) {
		this.dropEffect = 'all';
		this.effectAllowed = 'all';
		this.items = [];
		this.types = ['Files'];
		this.getData = function() {

		return files;
		};
		this.files = files;
		};

		function TriggerFileDownloads() {
			frame.makeOutputFiles()
		}

		var files = {};

		function FakeDataDownload(file, filename) {
			console.log("Fake file download: ", file, filename);
			files[filename] = file;
		}


		function createFormData() {
			var formData = new FormData();

			for(file in files) {
				var fileData = files[file];
				formData.append(file, files[file]);
				console.log(file, fileData)
			}

			formData.append("jsonData", '{"jobTitle":"123","interactionType":"RNA","saltConcentration":123,"steps":123,"temperatureUnits":"Celsius","temperature":123213}');


			var request = new XMLHttpRequest();
			request.open("POST", "http://localhost:9000/");
			request.send(formData);
			console.log(formData);


		}

	</script>
</html>